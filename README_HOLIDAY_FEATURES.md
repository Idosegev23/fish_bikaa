# 🎉 מערכת החגים המלאה - תיעוד טכני

## פיצ'רים שהושלמו ✅

### 1. **התראה חכמה בקופה**
- **קובץ**: `src/pages/OrderSummary.tsx`
- **תכונות**:
  - זיהוי אוטומטי של הזמנות 0-3 ימים לפני חג פעיל
  - פופאפ אלגנטי עם אפשרות לסמן הזמנה כ"הזמנת חג"
  - שמירת `is_holiday_order: true` ו-`holiday_id` בהזמנה

### 2. **מעקב הזמנות חג במסד הנתונים**
- **שדות חדשים בטבלת `orders`**:
  ```sql
  is_holiday_order BOOLEAN DEFAULT false
  holiday_id INTEGER REFERENCES holidays(id)
  ```
- **אינטגרציה**: כל הזמנה מתויגת אוטומטית עם פרטי החג הרלוונטי

### 3. **דף דוח ספקים מתקדם**
- **קובץ**: `src/pages/admin/AdminSupplierReport.tsx`
- **תכונות**:
  - בחירת חג מרשימה כולל חג פעיל
  - חישוב דרישות מדויק: יחידות vs ק"ג לפי סוג הדג
  - הצגת מלאי נוכחי מול דרישות
  - סימון ויזואלי של חסרים/עודפים בצבעים
  - הורדת דוח בפורמט JSON (ניתן להרחיב ל-PDF)

### 4. **תזמון אוטומטי של דוחות**
- **קובץ**: `api/holiday-scheduler.js`
- **תכונות**:
  - רץ אוטומטית בשעה 09:00 בכל יום (cron job)
  - זיהוי חגים המתקרבים (7 ימים קדימה)
  - יצירת דוח ספקים אוטומטי לכל חג
  - מייל אוטומטי לאדמין עם פירוט החסרים במלאי

### 5. **מייל אוטומטי לאדמין**
- **אינטגרציה**: בתוך `holiday-scheduler.js`
- **תכונות**:
  - תבנית HTML מעוצבת בעברית
  - טבלה מפורטת של דגים חסרים
  - מידע על כמויות נדרשות vs מלאי נוכחי
  - נשלח רק כשיש חסרים בפועל

## הגדרות נדרשות 🔧

### משתני סביבה ב-Vercel:
```bash
ADMIN_EMAIL=admin@fishstore.com  # אימייל האדמין לקבלת דוחות
EMAIL_USER=your-gmail@gmail.com  # אימייל לשליחה
EMAIL_PASS=your-app-password     # App Password של Gmail
```

### Cron Job הגדרה:
- מוגדר ב-`vercel.json`
- רץ יומית בשעה 09:00 UTC
- ניתן לשנות ל-`"0 6 * * *"` עבור 09:00 ישראל

## איך זה עובד? ⚙️

### תהליך האדמין:
1. **פתיחת חג** → נכנס לניהול חגים ומפעיל חג
2. **מעקב הזמנות** → לקוחות מזמינים ומתויגים אוטומטית
3. **דוח ידני** → נכנס לדוח ספקים לצפייה מיידית
4. **דוח אוטומטי** → שבוע לפני החג מקבל מייל עם הדוח

### תהליך הלקוח:
1. **זיהוי חג** → המערכת מזהה אם התאריך קרוב לחג
2. **פופאפ חכם** → שואל אם זו הזמנה לחג
3. **תיוג אוטומטי** → ההזמנה מתויגת ונכללת בדוחות

### הלוגיקה העסקית:
- **דגים ביחידות**: דניס, לברק, מושט וכו׳ (המרה מק״ג ליחידות)
- **דגים בק״ג**: סלמון, טונה, ברבוניה
- **עיגול כלפי מעלה**: מבטיח שלא יחסר מלאי
- **סיכון מינימלי**: רק דגים שבאמת חסרים מופיעים בדוח

## קבצים שנוספו/שונו 📁

### קבצים חדשים:
- `src/pages/admin/AdminSupplierReport.tsx`
- `api/holiday-scheduler.js`
- `README_HOLIDAY_FEATURES.md` (זה!)

### קבצים ששונו:
- `src/pages/OrderSummary.tsx` - התראה חכמה + שמירת שדות חג
- `src/App.tsx` - ניתוב לדף דוח ספקים
- `src/pages/admin/AdminDashboard.tsx` - לינק לדוח ספקים
- `vercel.json` - הוספת cron job ו-function

## בדיקות ותחזוקה 🔍

### בדיקה ידנית של הCron:
```bash
curl https://your-domain.vercel.app/api/holiday-scheduler
```

### לוגים ב-Vercel:
- נכנסים לפרויקט → Functions → holiday-scheduler
- ניתן לראות לוגים של הרצות יומיות

### חיבור מסד הנתונים:
- וודאו שהשדות `is_holiday_order` ו-`holiday_id` קיימים בטבלת `orders`
- הרצה ידנית:
```sql
ALTER TABLE orders ADD COLUMN IF NOT EXISTS is_holiday_order BOOLEAN DEFAULT false;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS holiday_id INTEGER REFERENCES holidays(id);
```

## יתרונות המערכת 🚀

✅ **אוטומציה מלאה** - מהזמנה ועד דוח ספקים  
✅ **חסכון בזמן** - אין צורך בחישובים ידניים  
✅ **מניעת אזילת מלאי** - התראות מוקדמות  
✅ **חוויית לקוח משופרת** - זיהוי חכם של הזמנות חג  
✅ **דיוק עסקי** - התייחסות נכונה ליחידות vs ק״ג  
✅ **סקלביליות** - התמודדות עם מספר חגים במקביל  

המערכת מוכנה לפרודקשן! 🎯